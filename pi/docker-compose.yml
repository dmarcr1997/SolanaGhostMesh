version: "3.7"
services:
  yolo-watcher:
    container_name: yolo-watcher
    build:
      context: .
      dockerfile: Dockerfile
    privileged: true
    ipc: host
    restart: unless-stopped
    volumes:
      - ./yolo_input:/yolo_input
      - ./yolo_output:/yolo_output

    environment:
      - YOLO_INPUT_DIR=/yolo_input
      - YOLO_OUTPUT_DIR=/yolo_output

  pinata-publisher:
    build:
      context: .
      dockerfile: Dockerfile.uploader
    restart: unless-stopped
    environment:
      JWT: ${JWT}
      GATE: ${GATE}
      PRED_DIR: /yolo_output
      OUT_DIR: /logs
    volumes:
      - ./yolo_output/output_imgs:/yolo_output
      - ./logs:/logs
  sol-submit:
    build:
      context: .
      dockerfile: Dockerfile.sol
    restart: unless-stopped
    environment:
      API_URL: { $API_URL }
      LOG_FILE: /data/log.json
      WALLET: /secrets/pub.json
    volumes:
      - ./logs:/data
      - /home/mossy/sec:/secrets
    depends_on:
      - pinata-publisher
